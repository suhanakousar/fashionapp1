# AUTO-GENERATED BY KIRO
# Enhanced Kiro Specification for Fashion Fusion System

name: "Fashion Fusion System - Photorealistic Garment Assembly"
version: "2.0.0"
description: "Complete system for generating photorealistic mannequin images from fabric inputs using ML models"

modules:
  - name: "fusion-pipeline"
    description: "Enhanced fusion processing pipeline with SAM, ControlNet, face protection"
    files:
      - "server/fusionPipeline.ts"
      - "server/fusion.ts"
      - "server/faceProtect.ts"
      - "server/models/bytez.ts"
      - "server/models/huggingface.ts"
      - "server/models/replicate.ts"
    endpoints:
      - "POST /api/fusion/upload"
      - "POST /api/fusion/create"
      - "GET /api/fusion/status/:jobId"
      - "GET /api/fusion/results/:jobId"
      - "DELETE /api/fusion/image/:imageId"
    
  - name: "fusion-ui"
    description: "React components for enhanced fusion workspace"
    files:
      - "client/src/pages/Fusion.tsx"
      - "client/src/components/CategorySelector.tsx"
      - "client/src/components/FabricUploader.tsx"
      - "client/src/components/FusionOptions.tsx"
      - "client/src/components/FusionProgress.tsx"
      - "client/src/components/FusionResults.tsx"
      - "client/src/components/TryOnCanvas.tsx"
      - "client/src/components/ExplainabilityPanel.tsx"
      - "client/src/components/MannequinCanvas.tsx"
    
  - name: "training"
    description: "Training scripts for fine-tuning garment models"
    files:
      - "train_lora.sh"
      - "train_dataset_prep.py"
      - "configs/lora_config.yaml"

events:
  - name: "onUpload"
    description: "Triggered when user uploads fabric images"
    hook: ".kiro/hooks/onUpload.hook.yaml"
    
  - name: "onFusionComplete"
    description: "Triggered when fusion job completes"
    hook: ".kiro/hooks/onFusionComplete.hook.yaml"

image_processing:
  face_detection:
    providers:
      - "huggingface" # damo/retinaface
      - "bytez" # Hemg/Face-Mask-Detection or damo/retinaface
      - "cloudinary" # Fallback
    auto_mask: false  # REVIEW REQUIRED: Policy decision
    require_consent: true  # REVIEW REQUIRED: Privacy policy
  
  segmentation:
    provider: "huggingface"  # facebook/sam-vit-base
    fallback: "bytez"
    use_for: ["garment_regions", "motif_extraction"]
  
  edge_detection:
    provider: "bytez"  # canny-edge or hed
    fallback: "cloudinary"
    use_for: ["controlnet_conditioning"]
  
  fusion:
    providers:
      - "huggingface"  # ControlNet + SD
      - "replicate"  # Alternative
      - "mock"  # Fallback for demo
    models:
      - "lllyasviel/control_v11p_sd15_canny"
      - "stabilityai/stable-diffusion-xl-base-1.0"
    modes:
      - "silhouette-first"
      - "texture-first"
      - "hybrid"
  
  upscaling:
    provider: "huggingface"  # xinntao/Real-ESRGAN
    fallback: "cloudinary"
    scale: 2
  
  feature_extraction:
    provider: "huggingface"  # openai/clip-vit-base-patch32
    use_for: ["explainability", "fabric_matching"]

storage:
  images: "cloudinary"
  metadata: "mongodb"
  jobs: "mongodb"
  ttl: 30  # days (REVIEW REQUIRED: Data retention policy)

prompts:
  templates: ".kiro/prompts/fusion_prompt_templates.md"
  steering: ".kiro/steering.md"

training:
  approach: "LoRA"  # or "SPADE"
  dataset_size: "5k-20k per category"
  categories: ["lehenga", "blouse", "gown", "saree", "salwar", "dress", "top", "skirt"]
  scripts:
    - "train_lora.sh"
    - "train_dataset_prep.py"
